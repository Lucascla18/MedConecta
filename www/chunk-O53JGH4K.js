import{a as be}from"./chunk-3UWS7PSM.js";import{a as _e,c as he,d as S,h as xe}from"./chunk-BI3SNNQC.js";import{D as ue}from"./chunk-RMY4OVEQ.js";import{A as m,Aa as se,B as o,C as i,D as x,E as P,Ea as ce,F as f,Fa as le,G as d,I as y,J as T,Ja as de,K as c,Ka as me,L as M,La as pe,M as w,Ma as ge,O as B,Oa as fe,P as H,Q as R,U as j,V as U,W as G,Y as J,da as K,ga as Q,la as X,m as _,ma as Y,pa as Z,q as b,qa as W,r as C,sa as ee,ta as te,ua as ne,w as s,wa as oe,xa as ie,y as q,ya as ae,z as h,za as re}from"./chunk-HUONWBXV.js";import"./chunk-WFQEB5QE.js";import"./chunk-7KGURMOZ.js";import"./chunk-KMRFCD75.js";import"./chunk-62GOUXOV.js";import"./chunk-QQOM2FGK.js";import"./chunk-KMHLOZFG.js";import"./chunk-NFKFN677.js";import"./chunk-4WFVMWDK.js";import"./chunk-MDMZPGPE.js";import"./chunk-L533IC4V.js";import"./chunk-NY44LQGJ.js";import"./chunk-IFR4H3YE.js";import"./chunk-LF5XB4YN.js";import{a as $,e as u}from"./chunk-BDMMXEV4.js";var I=be("LocalNotifications",{web:()=>import("./chunk-I5HRKXDF.js").then(r=>new r.LocalNotificationsWeb)});function ye(r,l){if(r&1&&(o(0,"div",18)(1,"div",19),c(2),i(),o(3,"div",20)(4,"span",21),c(5),i(),o(6,"span",22),c(7),i()()()),r&2){let a=d();s(),y("background-color",a.selectedDoctor.color),s(),w(" ",a.selectedDoctor.initials," "),s(3),M(a.selectedDoctor.name),s(2),M(a.selectedDoctor.specialty)}}function Te(r,l){r&1&&(o(0,"div",23),x(1,"ion-icon",24),o(2,"span"),c(3,"Clique para buscar um m\xE9dico"),i()())}function Se(r,l){if(r&1){let a=P();o(0,"div",25),f("click",function(){let n=b(a).$implicit,t=d();return C(t.selectTime(n))}),c(1),i()}if(r&2){let a=l.$implicit,e=d();T("selected",e.selectedTime===a),s(),w(" ",a," ")}}function Ie(r,l){if(r&1){let a=P();o(0,"div",25),f("click",function(){let n=b(a).$implicit,t=d();return C(t.selectTime(n))}),c(1),i()}if(r&2){let a=l.$implicit,e=d();T("selected",e.selectedTime===a),s(),w(" ",a," ")}}function Ee(r,l){r&1&&x(0,"ion-icon",35)}function ke(r,l){if(r&1){let a=P();o(0,"ion-item",32),f("click",function(){let n=b(a).$implicit,t=d(2);return C(t.selectDoctor(n))}),o(1,"ion-avatar",33),c(2),i(),o(3,"ion-label")(4,"h2"),c(5),i(),o(6,"p"),c(7),i()(),h(8,Ee,1,0,"ion-icon",34),i()}if(r&2){let a=l.$implicit,e=d(2);s(),y("background-color",a.color),s(),w(" ",a.initials," "),s(3),M(a.name),s(2),M(a.specialty),s(),m("ngIf",(e.selectedDoctor==null?null:e.selectedDoctor.id)===a.id)}}function Ae(r,l){if(r&1){let a=P();o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-title"),c(3,"Selecionar M\xE9dico"),i(),o(4,"ion-buttons",26)(5,"ion-button",27),f("click",function(){b(a);let n=d();return C(n.setOpen(!1))}),x(6,"ion-icon",28),i()()(),o(7,"ion-toolbar")(8,"ion-searchbar",29),f("ionInput",function(n){b(a);let t=d();return C(t.searchDoctor(n))}),i()()(),o(9,"ion-content")(10,"ion-list",30),h(11,ke,9,6,"ion-item",31),i()()}if(r&2){let a=d();s(11),m("ngForOf",a.filteredDoctors)}}var Xe=(()=>{let l=class l{constructor(){this.pageTitle="Agendar Consulta",this.doctorsList=[],this.filteredDoctors=[],this.selectedDoctor=null,this.isDoctorModalOpen=!1,this.morningSlots=["08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30"],this.afternoonSlots=["13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30"],this.selectedTime=null,this.selectedDate=new Date().toISOString(),this.minDate=new Date().toISOString(),this.route=_(J),this.navCtrl=_(Y),this.toastCtrl=_(me),this.loadingCtrl=_(de),this.auth=_(ue),this.firestore=_(_e)}ngOnInit(){return u(this,null,function*(){yield this.loadDoctorsFromFirebase(),yield this.requestNotificationPermission(),this.route.queryParams.subscribe(e=>{if(e&&e.doctorName){let n=this.doctorsList.find(t=>t.name===e.doctorName);n&&(this.selectedDoctor=n)}})})}requestNotificationPermission(){return u(this,null,function*(){(yield I.requestPermissions()).display!=="granted"&&console.log("Permiss\xE3o de notifica\xE7\xE3o negada")})}loadDoctorsFromFirebase(){return u(this,null,function*(){try{let e=yield xe(S(this.firestore,"doctors"));this.doctorsList=e.docs.map(n=>$({id:n.id},n.data())),this.filteredDoctors=[...this.doctorsList]}catch(e){console.error("Erro ao carregar m\xE9dicos:",e)}})}setOpen(e){this.isDoctorModalOpen=e,e&&(this.filteredDoctors=[...this.doctorsList])}searchDoctor(e){let n=e.target.value.toLowerCase();this.filteredDoctors=this.doctorsList.filter(t=>t.name.toLowerCase().includes(n)||t.specialty.toLowerCase().includes(n))}selectDoctor(e){this.selectedDoctor=e,this.setOpen(!1)}selectTime(e){this.selectedTime=e}generateMeetLink(){let e=Math.random().toString(36).substring(2,5),n=Math.random().toString(36).substring(2,6),t=Math.random().toString(36).substring(2,5);return`https://meet.google.com/${e}-${n}-${t}`}saveAppointment(){return u(this,null,function*(){if(!this.selectedDoctor||!this.selectedTime)return;let e=this.auth.currentUser;if(!e)return;let n=yield this.loadingCtrl.create({message:"Agendando..."});yield n.present();try{let t=this.generateMeetLink(),p={userId:e.uid,doctorName:this.selectedDoctor.name,specialty:this.selectedDoctor.specialty,doctorColor:this.selectedDoctor.color,doctorInitials:this.selectedDoctor.initials,dateIso:this.selectedDate,dateLabel:new Date(this.selectedDate).toLocaleDateString("pt-BR"),timeLabel:this.selectedTime,status:"scheduled",createdAt:new Date().toISOString(),meetLink:t};yield he(S(this.firestore,"appointments"),p),yield this.scheduleAdvancedNotifications(),n.dismiss(),this.showToast("Consulta agendada! Lembretes definidos."),this.navCtrl.navigateBack("/tabs/home")}catch{n.dismiss(),this.showToast("Erro ao agendar.")}})}scheduleAdvancedNotifications(){return u(this,null,function*(){let e=new Date(this.selectedDate),[n,t]=this.selectedTime.split(":");e.setHours(parseInt(n),parseInt(t),0,0);let p=new Date,g=[],E=Math.floor(Math.random()*1e5),v=(D,N,z,V,Oe)=>{let O=e.getTime()-p.getTime();D>p?g.push({title:N,body:z,id:E+V,schedule:{at:D},sound:"default",attachments:[],actionTypeId:"",extra:null}):O>0&&O<e.getTime()-D.getTime()&&O>Oe&&g.push({title:N,body:z,id:E+V,schedule:{at:new Date(p.getTime()+2e3)},sound:"default",attachments:[],actionTypeId:"",extra:null})},k=900*1e3,A=3600*1e3,L=360*60*1e3,F=1440*60*1e3,Ce=2880*60*1e3,ve=new Date(e.getTime()-Ce);v(ve,"\u{1F4C5} Em 2 dias",`Sua consulta com ${this.selectedDoctor.name} est\xE1 chegando.`,1,F);let Pe=new Date(e.getTime()-F);v(Pe,"\u{1F514} \xC9 Amanh\xE3!",`N\xE3o esque\xE7a sua consulta \xE0s ${this.selectedTime}.`,2,L);let Me=new Date(e.getTime()-L);v(Me,"\u{1F31F} \xC9 Hoje!",`Sua consulta \xE9 hoje \xE0s ${this.selectedTime}.`,3,A);let we=new Date(e.getTime()-A);v(we,"\u23F0 Falta 1 hora","Prepare-se para o atendimento.",4,k);let De=new Date(e.getTime()-k);v(De,"\u{1F3A5} Come\xE7a em 15 min","Acesse o app e verifique sua conex\xE3o.",5,0),g.length>0&&(yield I.schedule({notifications:g}),console.log(`${g.length} notifica\xE7\xF5es agendadas.`))})}showToast(e){return u(this,null,function*(){(yield this.toastCtrl.create({message:e,duration:3e3,position:"bottom",color:"dark"})).present()})}};l.\u0275fac=function(n){return new(n||l)},l.\u0275cmp=q({type:l,selectors:[["app-agendamento"]],decls:34,vars:8,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","/tabs/home","text","","color","dark"],[1,"ion-padding"],[1,"section-label"],[1,"doctor-selector",3,"click"],["class","selected-info",4,"ngIf"],["class","placeholder-info",4,"ngIf"],["name","chevron-down-outline",1,"chevron"],[1,"calendar-container"],["presentation","date","locale","pt-BR","size","cover",3,"ngModelChange","ngModel","min"],[1,"time-grid"],["class","time-chip",3,"selected","click",4,"ngFor","ngForOf"],[1,"section-label","mt-4"],[1,"footer-space"],[1,"fixed-bottom"],["expand","block","shape","round",3,"click","disabled"],[3,"didDismiss","isOpen"],[1,"selected-info"],[1,"mini-avatar"],[1,"text"],[1,"name"],[1,"spec"],[1,"placeholder-info"],["name","search-outline"],[1,"time-chip",3,"click"],["slot","end"],["color","medium",3,"click"],["slot","icon-only","name","close-outline"],["placeholder","Buscar por nome...","mode","ios",3,"ionInput"],["lines","none"],["button","","class","doctor-item",3,"click",4,"ngFor","ngForOf"],["button","",1,"doctor-item",3,"click"],["slot","start",1,"modal-avatar"],["name","checkmark-circle","color","primary","slot","end",4,"ngIf"],["name","checkmark-circle","color","primary","slot","end"]],template:function(n,t){n&1&&(o(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),x(3,"ion-back-button",2),i(),o(4,"ion-title"),c(5,"Agendar Consulta"),i()()(),o(6,"ion-content",3)(7,"section")(8,"ion-label",4),c(9,"Especialista"),i(),o(10,"div",5),f("click",function(){return t.setOpen(!0)}),h(11,ye,8,5,"div",6)(12,Te,4,0,"div",7),x(13,"ion-icon",8),i()(),o(14,"section")(15,"ion-label",4),c(16,"Data"),i(),o(17,"div",9)(18,"ion-datetime",10),R("ngModelChange",function(g){return H(t.selectedDate,g)||(t.selectedDate=g),g}),i()()(),o(19,"section")(20,"ion-label",4),c(21,"Manh\xE3"),i(),o(22,"div",11),h(23,Se,2,3,"div",12),i(),o(24,"ion-label",13),c(25,"Tarde"),i(),o(26,"div",11),h(27,Ie,2,3,"div",12),i()(),x(28,"div",14),i(),o(29,"div",15)(30,"ion-button",16),f("click",function(){return t.saveAppointment()}),c(31," Confirmar Agendamento "),i()(),o(32,"ion-modal",17),f("didDismiss",function(){return t.setOpen(!1)}),h(33,Ae,12,1,"ng-template"),i()),n&2&&(s(11),m("ngIf",t.selectedDoctor),s(),m("ngIf",!t.selectedDoctor),s(6),B("ngModel",t.selectedDate),m("min",t.minDate),s(5),m("ngForOf",t.morningSlots),s(4),m("ngForOf",t.afternoonSlots),s(3),m("disabled",!t.selectedDoctor||!t.selectedTime),s(2),m("isOpen",t.isDoctorModalOpen))},dependencies:[G,j,U,X,K,Q,ie,le,ne,Z,ce,oe,re,ae,pe,te,W,fe,se,ee,ge],styles:['@charset "UTF-8";[_nghost-%COMP%]{--page-background: #ffffff}ion-content[_ngcontent-%COMP%]{--background: #ffffff}ion-toolbar[_ngcontent-%COMP%]{--background: #ffffff}ion-toolbar[_ngcontent-%COMP%]   ion-title[_ngcontent-%COMP%]{font-weight:700;color:#1e293b;font-size:18px}.section-label[_ngcontent-%COMP%]{display:block;font-size:16px;font-weight:600;color:#334155;margin-bottom:12px;margin-top:8px;padding-left:4px}.mt-4[_ngcontent-%COMP%]{margin-top:20px}section[_ngcontent-%COMP%]{margin-bottom:24px}.doctor-selector[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;border-radius:16px;padding:12px 16px;display:flex;align-items:center;justify-content:space-between;min-height:60px;transition:all .2s}.doctor-selector[_ngcontent-%COMP%]:active{background:#f1f5f9;transform:scale(.99)}.selected-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.selected-info[_ngcontent-%COMP%]   .mini-avatar[_ngcontent-%COMP%]{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#334155;font-size:14px}.selected-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{display:flex;flex-direction:column}.selected-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{font-weight:600;color:#1e293b;font-size:15px}.selected-info[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]   .spec[_ngcontent-%COMP%]{font-size:13px;color:#64748b}.placeholder-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;color:#94a3b8;font-size:14px}.placeholder-info[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.chevron[_ngcontent-%COMP%]{color:#94a3b8;font-size:18px}.calendar-container[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:20px;overflow:hidden;box-shadow:0 4px 12px #00000008}ion-datetime[_ngcontent-%COMP%]{--background: #ffffff;border-radius:20px}.time-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}.time-chip[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;color:#64748b;padding:10px 4px;border-radius:12px;text-align:center;font-weight:500;font-size:13px;cursor:pointer;transition:all .2s}.time-chip.selected[_ngcontent-%COMP%]{background:var(--ion-color-primary);color:#fff;border-color:var(--ion-color-primary);font-weight:600;box-shadow:0 4px 10px rgba(var(--ion-color-primary-rgb),.3)}.modal-avatar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;font-weight:700;color:#334155}.doctor-item[_ngcontent-%COMP%]{--padding-start: 16px;--inner-padding-end: 16px;margin-bottom:8px}.doctor-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-weight:600;font-size:15px;color:#1e293b}.doctor-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:13px}.footer-space[_ngcontent-%COMP%]{height:90px}.fixed-bottom[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;background:#fff;padding:16px 24px 30px;border-top:1px solid #f1f5f9;z-index:10}.fixed-bottom[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:50px;--border-radius: 14px;font-weight:600;font-size:16px;margin:0;--box-shadow: 0 8px 20px rgba(var(--ion-color-primary-rgb), .25)}']});let r=l;return r})();export{Xe as AgendamentoPage};
